---
title: "MiniProject #01 – Netflix Top 10"
author: "Jimin Hong"
date: "`r Sys.Date()`"
format:
  html:
    theme: default
    toc: true
    toc-depth: 3
    code-fold: true
    code-summary: "Show code"
    embed-resources: true
editor: visual
excute:
  warning: false
  message: false 
  echo: true
---
# Data Acquisition
```{r}
#Data Acquisition
if(!dir.exists(file.path("data", "mp01"))){
    dir.create(file.path("data", "mp01"), showWarnings=FALSE, recursive=TRUE)
}

GLOBAL_TOP_10_FILENAME <- file.path("data", "mp01", "global_top10_alltime.csv")

if(!file.exists(GLOBAL_TOP_10_FILENAME)){
    download.file("https://www.netflix.com/tudum/top10/data/all-weeks-global.tsv", 
                  destfile=GLOBAL_TOP_10_FILENAME)
}

COUNTRY_TOP_10_FILENAME <- file.path("data", "mp01", "country_top10_alltime.csv")

if(!file.exists(COUNTRY_TOP_10_FILENAME)){
    download.file("https://www.netflix.com/tudum/top10/data/all-weeks-countries.tsv", 
                  destfile=COUNTRY_TOP_10_FILENAME)
}
```
# Data Import and Prep
```{r}
#Data Import and Prep
if(!require("tidyverse")) install.packages("tidyverse")
library(readr)
library(dplyr)

GLOBAL_TOP_10 <- read_tsv(GLOBAL_TOP_10_FILENAME)
GLOBAL_TOP_10 <- GLOBAL_TOP_10 |>
  mutate(season_title = if_else(season_title == "N/A", NA_character_, season_title))
glimpse(GLOBAL_TOP_10) 
COUNTRY_TOP_10 <- read_tsv("data/mp01/country_top10_alltime.csv", na = "N/A", show_col_types = FALSE)
glimpse(COUNTRY_TOP_10)

```

# Initial Data Exploration
```{r}
#Initial Data Exploration
library(DT)
GLOBAL_TOP_10 |> 
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE))
library(stringr)
format_titles <- function(df){
    colnames(df) <- str_replace_all(colnames(df), "_", " ") |> str_to_title()
    df
}

GLOBAL_TOP_10 |> 
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views'))
GLOBAL_TOP_10 |> 
    select(-season_title) |>
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views'))
GLOBAL_TOP_10 |> 
    mutate(`runtime_(minutes)` = round(60 * runtime)) |>
    select(-season_title, 
           -runtime) |>
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views'))
```

# Netflix Top 10 EDA 

### Q1.How many different countries does Netflix operate in?
```{r}
countries_tbl<-COUNTRY_TOP_10 |>
  distinct(country_iso2, country_name) |>
  arrange(country_name)

n_countries <- nrow(countries_tbl)
```
Netflix appears to operate in **`r n_countries`** countries  

### Q2. Which non-English-language film has spent the most cumulative weeks in the global top 10? How many weeks did it spend?

```{r}
q2_table <- GLOBAL_TOP_10 |>
  filter(category == "Films (Non-English)") |>
  group_by(show_title) |>
  summarise(weeks = max(cumulative_weeks_in_top_10, na.rm = TRUE), .groups = "drop") |>
  arrange(desc(weeks))

q2_top <- q2_table |> slice(1)

```
The non-English-language film with the most cumulative weeks in the global top 10 is **`r q2_top$show_title`**, with **`r q2_top$weeks`** weeks.

### Q3. What is the longest film (English or non-English) to have ever appeared in the Netflix global Top 10? How long is it in minutes?

```{r}
q3_tbl <- GLOBAL_TOP_10 |>
  filter(startsWith(category, "Films"), !is.na(runtime)) |>
  mutate(runtime_min = round(runtime * 60)) |>
  arrange(desc(runtime_min)) |>
  slice(1)

q3_title   <- q3_tbl$show_title
q3_minutes <- q3_tbl$runtime_min
```
The longest film to have appeared in the global Top 10 is **`r q3_title`**, at **`r q3_minutes`** minutes  

### Q4. For each of the four categories, what program has the most total hours of global viewership?

```{r}
q4_tbl <- GLOBAL_TOP_10 |>
  mutate(program = if_else(is.na(season_title) | season_title == "", show_title, paste(show_title, season_title, sep = "-"))) |>
  group_by(category, program) |>
  summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE), .groups = "drop") |>
  group_by(category) |>
  slice_max(total_hours, n = 1, with_ties = FALSE) |>
  ungroup()

q4_tbl <- q4_tbl |>
  rename(Category = category, Program = program, `Total Hours (Global)` = total_hours) |>
  arrange(desc(`Total Hours (Global)`))

datatable(q4_tbl, class = "hover", caption = "Top program by total global viewrship hours in each categpry", rownames = FALSE) |>
  formatRound("Total Hours (Global)", 0)


```

### Q5. Which TV show had the longest run in a country’s Top 10? How long was this run and in what country did it occur?  

```{r}
q5_runs <- COUNTRY_TOP_10 |>
  filter(startsWith(category, "TV")) |>
  mutate(
    program = if_else(
      is.na(season_title) | season_title == "",
      show_title,
      paste(show_title, season_title, sep = " — ")
    )
  ) |>
  arrange(country_name, program, week) |>
  group_by(country_name, program) |>
  mutate(
    gap_days = as.integer(week - lag(week)),  
    new_run  = is.na(gap_days) | gap_days != 7,
    run_id   = cumsum(new_run)
  ) |>
  ungroup()
q5_summary <- q5_runs |>
  group_by(country_name, program, run_id) |>
  summarise(run_weeks = n(), .groups = "drop") |>
  arrange(desc(run_weeks)) |>
  slice(1)

q5_program <- q5_summary$program
q5_country <- q5_summary$country_name
q5_weeks   <- q5_summary$run_weeks
```
The longest run is **`r q5_weeks`** weeks for **`r q5_program`** in **`r q5_country`**.

### Q6. Netflix provides over 200 weeks of service history for all but one country in our data set. Which country is this and when did Netflix cease operations in that country?

```{r}
#Find a country which has less than 200 weeks of service history

q6_service_history <- COUNTRY_TOP_10 |>
  group_by(country_name) |>
  summarise(num_weeks = n_distinct(week)) |>
  filter(num_weeks < 200)
q_country <-q6_service_history$country_name 

q_date <- COUNTRY_TOP_10 |>
  filter(country_name == q_country) |>
  summarise(last_date = max(week))|>
  pull(last_date)

```
**`r q_country`** is the one country with less than 200 weeks of service history, where Netflix ceased operations on **`r q_date`**

### Q7. What is the total viewership of the TV show Squid Game?

```{r}
q7_squid_game <-GLOBAL_TOP_10 |>
  filter(show_title == "Squid Game") |>
  summarise(total_hours = sum(weekly_hours_viewed, na.rm =TRUE)) |>
  pull(total_hours)
```
The total viewership for Squid Game is **`r round(q7_squid_game/1e9,1)` billion** hours across all seasons. 

### Q8. The movie Red Notice has a runtime of 1 hour and 58 minutes. Approximately how many views did it receive in 2021?

```{r}
library(lubridate)
red_notice_runtime_hours <- 1 + 58 / 60
q8_red_notice <- GLOBAL_TOP_10 |>
  filter(year(week) == 2021)|>
  summarise(total_viewership = sum(weekly_hours_viewed, na.rm = TRUE)) |>
  mutate(approx_views = total_viewership / red_notice_runtime_hours) |> 
  pull(approx_views)
```
The total viewership for Red Notice in 2021 is **`r round(q8_red_notice/1e9,1)` billion**

### Q9. How many Films reached Number 1 in the US but did not originally debut there? That is, find films that first appeared on the Top 10 chart at, e.g., Number 4 but then became more popular and eventually hit Number 1? What is the most recent film to pull this off?

```{r}
q9_films <-COUNTRY_TOP_10 |>
  filter(country_name == "United States", category == "Films")|>
  group_by(show_title)|>
  summarise(debut_rank = weekly_rank[which.min(week)], peak_rank = min(weekly_rank), peak_rank = min(weekly_rank), recent_appearance = max(week), .groups = "drop") |>
  filter(debut_rank > 1, peak_rank == 1) |> 
  arrange(desc(recent_appearance))
datatable(q9_films,options=list(searching=FALSE, info=FALSE),colnames = c('Show Title', 'Debut Rank', 'Peak Rank', 'Recent Appearance'))
  

q9_num_films <- nrow(q9_films)
q9_recent_film<-q9_films$show_title[1]
```
A total of **`r q9_num_films`** films have reached Number 1 in the US with the most recent being **`r q9_recent_film`**.

### Q10. Which TV show/season hit the top 10 in the most countries in its debut week? In how many countries did it chart?
```{r}
q10_debut <- COUNTRY_TOP_10 |>
  filter(category == "TV") |>
  group_by(show_title) |>
  mutate(debut_week = min(week)) |> 
  ungroup() |>
  filter(week == debut_week)|>
  group_by(show_title, season_title)|>
  summarise(countries = n_distinct(country_name), .groups = "drop") |>
  arrange(desc(countries)) |>
  slice(1)
q10_show_title <- q10_debut$season_title
q10_countries <- q10_debut$countries
```
The TV show/season that hit the top 10 in the most countries in its debut week is **`r q10_show_title`**.



# Press release
```{r}
#press 1 

#total viewership
total_viewership <- GLOBAL_TOP_10 |>
  filter(show_title == "Stranger Things") |>
  summarise(total_hours = sum(weekly_hours_viewed, na.rm= TRUE)) |>
  pull(total_hours) 

#length of popularity 
length_of_popularity <- GLOBAL_TOP_10 |>
  filter(show_title == "Stranger Things") |>
  summarise(max_weeks = max(cumulative_weeks_in_top_10, na.rm = TRUE)) |>
  pull(max_weeks)

#multinational appeal
multinational_appeal <- COUNTRY_TOP_10 |> 
  filter(show_title == "Stranger Things") |>
  summarise(num_countries = n_distinct(country_name)) |> 
  pull(num_countries)

```

## A Global Sensation in `r multinational_appeal` Countries, ***'Stranger Things'*** Final Chapter Lands in 2025 

 *'Stranger Things'* has been recorded over `r round(total_viewership/ 1e9, 1)` billion cumulative hours viewed, proving its place as one of the most beloved series in Netflix. Additionally, the series has demonstrated incredible staying power by remaining in the global TOP 10 for an impressive `r length_of_popularity` weeks, a figure that significantly surpasses the record of other hit shows like *'Bridgerton'*


 


```{r}
# Make a list of all titles that appeared in the US TOP 10 
us_lists <- COUNTRY_TOP_10 |>
  filter(country_name == "United States") |>
  distinct(show_title)

# Find popular contents in India (Top4)

india_top4_contents <- COUNTRY_TOP_10 |>
  filter(country_name == "India") |>
  anti_join(us_lists, by = "show_title") |>
  group_by(show_title, category) |>
  summarise(weeks_in_india_top10 = n_distinct(week), .groups ="drop") |>
  arrange(desc(weeks_in_india_top10)) |>
  slice(1:4)

# viewership of top1 Nextflix contents with Hindi-language

total_viewership <- GLOBAL_TOP_10 |>
  filter(show_title == "The Great Indian Kapil Show") |>
  summarise(total_hours = sum(weekly_hours_viewed, na.rm= TRUE)) |>
  pull(total_hours)


# show a table
datatable(india_top4_contents, caption = "Top 4 popular Netflix Contents in India (Not Charting in the US)",colnames = c("Show Title", "Category", "Weeks in India Top 10"), options = list(pageLength = 4, searching = FALSE), rownames = FALSE)
```

## Netflix's Hindi Contents Are Shaking Up Bollywood 

As the world's most populous country, India is emerging as one of Netflix's fastest growing markets. Recent data illustrate that Hindi-language contents are capturing massive attention in India. *'The Great Indian Kapil Show'* hits **44** weeks and **44** million viewers on India's Top 10. They were followed by *The Railway Men - The Untold Story of Bhopal 1984 (30 weeks)*, *Khakee: TheBihar Chapter (29 weeks)*, and *Maaml Legal Hai (26 weeks)* on India's Top 10. 

 
```{r}
# Find countries that Kpop Demon Hunters ranked #1 
kpop_demon_hunters_stats <- COUNTRY_TOP_10 |>
  filter(show_title == "KPop Demon Hunters") |>
  summarise(
    country_count = n_distinct(country_name), 
    peak_rank = min(weekly_rank, na.rm = TRUE), 
    countries_at_no1 = list(unique(country_name[weekly_rank == 1]))
  )

# Total viewership 
kpop_demon_hunters_viewership <- GLOBAL_TOP_10 |>
  filter(show_title == "KPop Demon Hunters") |>
  summarise(total_hours = sum(weekly_hours_viewed, na.rm = TRUE)) |>
  pull(total_hours)

# Number of countries that Kpop Demon Hunters recorded Top1
did_it_hit_no1 <-nrow(filter(COUNTRY_TOP_10, show_title == "KPop Demon Hunters", weekly_rank == 1)) > 0 
num_countries_at_no1 <- length(kpop_demon_hunters_stats$countries_at_no1[[1]])
```

## From Korea to the World Stage: *K-Pop Demon Hunters* Conquers the #1 Spot in `r num_countries_at_no1`countries

Netflix has highlighted the global appeal of Korea's K-Pop culture with the unprecedented success of its latest original animation, *K-Pop Demon Hunters*. It has surpassed the toal viewer ship of all *Squid Game* seasons combined, recording **559.1 million** views. The content also topped the charts in 76 countries, proving the worldwide pull of Korean culture. 